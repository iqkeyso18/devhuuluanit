<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Qu·∫£n L√Ω Trung T√¢m To√°n C√¥ Huy·ªÅn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* S·ª≠ d·ª•ng font Inter hi·ªán ƒë·∫°i */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* N·ªÅn tr·∫Øng xanh nh·∫°t hi·ªán ƒë·∫°i */
        }
        
        .main-content-area {
            min-height: calc(100vh - 80px);
        }
        
        /* 1. Thi·∫øt k·∫ø Card Cao C·∫•p (Premium Card Style) */
        .card-premium {
            border-radius: 1.5rem; /* rounded-3xl */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
            border: 1px solid #f3f4f6;
        }
        .card-premium:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -8px rgba(0, 0, 0, 0.1), 0 10px 15px -7px rgba(0, 0, 0, 0.08);
        }

        /* 2. Style cho n√∫t Navigation Active */
        .nav-btn.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 10px -1px rgba(79, 70, 229, 0.5);
            transform: scale(1.02);
        }

        /* 3. Style t·∫≠p trung cho Input/Select (Focus Ring) */
        .form-input-style {
            transition: all 0.2s ease;
        }
        .form-input-style:focus {
            outline: 2px solid transparent; /* Lo·∫°i b·ªè outline m·∫∑c ƒë·ªãnh */
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.4); /* ring indigo-500/40 */
            border-color: #6366f1;
        }
        
        /* 4. Custom scrollbar cho table */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
    </style>
    
    <script>
        // --- C√ÅC H·∫∞NG S·ªê C·∫¶N THI·∫æT ---
        const ADMIN_PASSWORD = "admin"; // M·∫≠t kh·∫©u admin ƒë∆°n gi·∫£n (CH·ªà D√ôNG CHO DEMO)
        
        const CLASS_RATES = {
            '4.1': 80000, '4.2': 80000, '4.3': 80000,
            '5.1': 80000, '5.2': 80000, '5.3': 80000,
            '6.1': 80000, '6.2': 80000, '6.3': 80000,
            '7.1': 80000, '7.2': 80000, '7.3': 80000,
            '8.1': 80000, '8.2': 80000, '8.3': 80000,
            '9.1': 80000, '9.2': 80000, '9.3': 80000,
            '1-1': 200000 // L·ªõp k√®m 1-1
        };
        const CLASS_OPTIONS = Object.keys(CLASS_RATES);
        
        const STORAGE_KEYS = {
            students: 'huyenMathCenter_students',
            attendance: 'huyenMathCenter_attendance'
        };
        
        // --- BI·∫æN STATE TO√ÄN C·ª§C C·ª¶A ·ª®NG D·ª§NG ---
        let students = [];
        let attendanceRecords = [];
        let currentView = 'dashboard';
        let loggedIn = false;
        let currentMonth = new Date().toISOString().substring(0, 7); // YYYY-MM
        
        // --- H√ÄM QU·∫¢N L√ù LOCALSTORAGE (L∆ØU V√Ä T·∫¢I D·ªÆ LI·ªÜU) ---

        /** T·∫£i d·ªØ li·ªáu t·ª´ localStorage */
        const loadData = (type) => {
            const json = localStorage.getItem(STORAGE_KEYS[type]);
            try {
                return json ? JSON.parse(json) : [];
            } catch (e) {
                console.error(`L·ªói khi t·∫£i d·ªØ li·ªáu ${type} t·ª´ localStorage:`, e);
                return [];
            }
        };
        
        /** L∆∞u d·ªØ li·ªáu v√†o localStorage v√† t·ª± ƒë·ªông render l·∫°i UI */
        const saveData = (type, data) => {
            localStorage.setItem(STORAGE_KEYS[type], JSON.stringify(data));
            // C·∫≠p nh·∫≠t state c·ª•c b·ªô
            if (type === 'students') students = data;
            if (type === 'attendance') attendanceRecords = data;
            
            // Gi·∫£ l·∫≠p c·∫≠p nh·∫≠t real-time b·∫±ng c√°ch render l·∫°i c√°c view
            if (loggedIn) {
                if (currentView === 'students') renderStudentList();
                if (currentView === 'attendance') renderAttendanceView();
                if (currentView === 'tuition') renderTuitionTable();
                if (currentView === 'dashboard') renderIncomeDashboard();
            }
        };

        /** T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu khi ·ª©ng d·ª•ng kh·ªüi ƒë·ªông */
        const loadInitialData = () => {
            students = loadData('students');
            attendanceRecords = loadData('attendance');
        };

        // --- H√ÄM TI·ªÜN √çCH ---
        const formatCurrency = (amount) => {
            // S·ª≠ d·ª•ng Intl.NumberFormat ƒë·ªÉ hi·ªÉn th·ªã VND ƒë·∫πp m·∫Øt
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        };
        
        // --- H√ÄM QU·∫¢N L√ù T√ÄI KHO·∫¢N (CLIENT-SIDE FAKE ADMIN) ---
        window.handleLogin = () => {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                loggedIn = true;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('header-status').textContent = 'ƒê√£ ƒëƒÉng nh·∫≠p (Admin)';
                loadInitialData(); // T·∫£i d·ªØ li·ªáu ngay sau khi ƒëƒÉng nh·∫≠p
                switchView(currentView); // Hi·ªÉn th·ªã dashboard
            } else {
                showModal('L·ªói ƒêƒÉng Nh·∫≠p', 'M·∫≠t kh·∫©u qu·∫£n tr·ªã kh√¥ng ƒë√∫ng. Vui l√≤ng th·ª≠ l·∫°i.');
            }
            document.getElementById('admin-password').value = ''; // X√≥a m·∫≠t kh·∫©u
        };
        
        window.handleLogout = () => {
             showModal('X√°c Nh·∫≠n ƒêƒÉng Xu·∫•t', 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng?', () => {
                loggedIn = false;
                currentView = 'dashboard';
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('header-status').textContent = 'Ch∆∞a ƒëƒÉng nh·∫≠p';
                document.getElementById('nav-bar').querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
             });
        }

        // --- CHUY·ªÇN ƒê·ªîI VIEW ---
        window.switchView = (viewId) => {
            if (!loggedIn) return;
            currentView = viewId;
            document.querySelectorAll('.app-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            // X·ª≠ l√Ω Active state tr√™n thanh Nav
            document.querySelectorAll('#nav-bar button').forEach(el => 
                el.classList.remove('active'));
            document.querySelector(`button[onclick="switchView('${viewId}')"]`).classList.add('active');

            // Render l·∫°i n·ªôi dung c·ª• th·ªÉ
            if (viewId === 'students') renderStudentList();
            if (viewId === 'attendance') renderAttendanceView();
            if (viewId === 'tuition') renderTuitionTable();
            if (viewId === 'dashboard') renderIncomeDashboard();
        };
        
        // --- MODULE QU·∫¢N L√ù H·ªåC SINH ---
        window.handleAddStudent = (event) => {
            event.preventDefault();
            const nameInput = document.getElementById('new-student-name');
            const classSelect = document.getElementById('new-student-class');
            const name = nameInput.value.trim();
            const classId = classSelect.value;
            const tuitionRate = CLASS_RATES[classId];

            if (!name || !classId) {
                showModal('L·ªói', 'Vui l√≤ng nh·∫≠p t√™n v√† ch·ªçn l·ªõp h·ªçc.');
                return;
            }

            try {
                const newStudent = {
                    id: crypto.randomUUID(),
                    name,
                    classId,
                    tuitionRate,
                    createdAt: new Date().toISOString()
                };
                students.push(newStudent);
                saveData('students', students);
                
                showModal('Th√†nh C√¥ng', `ƒê√£ th√™m h·ªçc sinh ${name} v√†o l·ªõp ${classId}.`);
                nameInput.value = '';
                classSelect.value = CLASS_OPTIONS[0];
            } catch (e) {
                console.error("L·ªói khi th√™m h·ªçc sinh:", e);
                showModal('L·ªói', 'Kh√¥ng th·ªÉ th√™m h·ªçc sinh. Vui l√≤ng th·ª≠ l·∫°i.');
            }
        };
        
        window.handleEditStudent = (id, currentName, currentClass) => {
            // M·ªü modal ch·ªânh s·ª≠a
            document.getElementById('edit-student-id').value = id;
            document.getElementById('edit-student-name').value = currentName;
            document.getElementById('edit-student-class').innerHTML = CLASS_OPTIONS.map(c => 
                `<option value="${c}" ${c === currentClass ? 'selected' : ''}>${c}</option>`
            ).join('');
            document.getElementById('edit-modal').classList.remove('hidden');
        };

        window.submitEditStudent = () => {
            const id = document.getElementById('edit-student-id').value;
            const newName = document.getElementById('edit-student-name').value.trim();
            const newClassId = document.getElementById('edit-student-class').value;
            const newRate = CLASS_RATES[newClassId];
            
            if (!newName || !newClassId) {
                showModal('L·ªói', 'T√™n v√† L·ªõp kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.');
                return;
            }

            try {
                const index = students.findIndex(s => s.id === id);
                if (index !== -1) {
                    students[index] = { ...students[index], name: newName, classId: newClassId, tuitionRate: newRate };
                    saveData('students', students);
                    document.getElementById('edit-modal').classList.add('hidden');
                    showModal('Th√†nh C√¥ng', `ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin h·ªçc sinh ${newName}.`);
                }
            } catch (e) {
                console.error("L·ªói khi s·ª≠a h·ªçc sinh:", e);
                showModal('L·ªói', 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t h·ªçc sinh. Vui l√≤ng th·ª≠ l·∫°i.');
            }
        };
        
        window.handleDeleteStudent = (id, name) => {
            showModal('X√°c Nh·∫≠n X√≥a', `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc sinh ${name}? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c v√† s·∫Ω x√≥a t·∫•t c·∫£ b·∫£n ghi ƒëi·ªÉm danh li√™n quan.`, () => {
                try {
                    students = students.filter(s => s.id !== id);
                    saveData('students', students);
                    
                    // X√≥a c√°c b·∫£n ghi ƒëi·ªÉm danh li√™n quan
                    attendanceRecords = attendanceRecords.filter(r => r.studentId !== id);
                    saveData('attendance', attendanceRecords);
                    
                    showModal('Th√†nh C√¥ng', `ƒê√£ x√≥a h·ªçc sinh ${name}.`);
                } catch (e) {
                    console.error("L·ªói khi x√≥a h·ªçc sinh:", e);
                    showModal('L·ªói', 'Kh√¥ng th·ªÉ x√≥a h·ªçc sinh. Vui l√≤ng th·ª≠ l·∫°i.');
                }
            }, true); // C·ªù x√°c nh·∫≠n nguy hi·ªÉm
        };
        
        const renderStudentList = () => {
            const container = document.getElementById('student-list-container');
            const filterClass = document.getElementById('student-filter-class').value;
            const searchName = document.getElementById('student-search-name').value.toLowerCase();

            let filteredStudents = students.slice(); // Copy array
            if (filterClass !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.classId === filterClass);
            }
            if (searchName) {
                filteredStudents = filteredStudents.filter(s => s.name.toLowerCase().includes(searchName));
            }
            // S·∫Øp x·∫øp theo t√™n
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name, 'vi', { sensitivity: 'base' }));

            if (filteredStudents.length === 0) {
                container.innerHTML = `<p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Kh√¥ng t√¨m th·∫•y h·ªçc sinh n√†o ph√π h·ª£p v·ªõi ƒëi·ªÅu ki·ªán l·ªçc.</p>`;
                return;
            }

            const rows = filteredStudents.map(s => `
                <tr class="border-b last:border-b-0 hover:bg-indigo-50 transition duration-150">
                    <td class="p-4 text-sm font-semibold text-gray-800">${s.name}</td>
                    <td class="p-4 text-sm text-center">
                        <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-indigo-100 text-indigo-700">${s.classId}</span>
                    </td>
                    <td class="p-4 text-sm text-right font-medium text-green-600">${formatCurrency(s.tuitionRate)}</td>
                    <td class="p-4 text-sm text-center space-x-2">
                        <button onclick="handleEditStudent('${s.id}', '${s.name.replace(/'/g, "\\'")}', '${s.classId}')" 
                                title="Ch·ªânh s·ª≠a"
                                class="text-indigo-600 hover:text-indigo-800 transition duration-150 p-2 rounded-full hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                        </button>
                        <button onclick="handleDeleteStudent('${s.id}', '${s.name.replace(/'/g, "\\'")}')" 
                                title="X√≥a"
                                class="text-red-600 hover:text-red-800 transition duration-150 p-2 rounded-full hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </td>
                </tr>
            `).join('');

            container.innerHTML = `
                <div class="overflow-x-auto rounded-2xl shadow-lg border border-gray-100 mt-6 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th scope="col" class="px-4 py-4 text-left text-xs font-bold text-indigo-700 uppercase tracking-wider">T√™n H·ªçc Sinh</th>
                                <th scope="col" class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">L·ªõp</th>
                                <th scope="col" class="px-4 py-4 text-right text-xs font-bold text-indigo-700 uppercase tracking-wider">H·ªçc Ph√≠/Bu·ªïi</th>
                                <th scope="col" class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100">${rows}</tbody>
                    </table>
                </div>
            `;
        };
        window.renderStudentList = renderStudentList;

        // --- MODULE ƒêI·ªÇM DANH & H·ªåC PH√ç (GI·ªÆ NGUY√äN LOGIC) ---
        
        // L·∫•y b·∫£n ghi ƒëi·ªÉm danh (Attendance Record) theo studentId v√† monthYear
        const getAttendanceRecord = (studentId, monthYear) => {
            return attendanceRecords.find(r => r.studentId === studentId && r.monthYear === monthYear);
        };

        window.updateAttendance = (studentId, sessionNum) => {
            const currentMonthYear = document.getElementById('attendance-month-selector').value;
            const recordId = `${studentId}-${currentMonthYear}`;
            let record = getAttendanceRecord(studentId, currentMonthYear);

            if (record) {
                // C·∫≠p nh·∫≠t b·∫£n ghi ƒë√£ t·ªìn t·∫°i
                const currentState = record.sessions[sessionNum] || false;
                record.sessions[sessionNum] = !currentState;
                
                // C·∫≠p nh·∫≠t l·∫°i array
                attendanceRecords = attendanceRecords.map(r => r.id === recordId ? record : r);
            } else {
                // T·∫°o m·ªõi b·∫£n ghi
                const student = students.find(s => s.id === studentId);
                if (!student) {
                    showModal('L·ªói', 'Kh√¥ng t√¨m th·∫•y th√¥ng tin h·ªçc sinh.');
                    return;
                }
                
                // Kh·ªüi t·∫°o 10 bu·ªïi, set bu·ªïi hi·ªán t·∫°i l√† true
                let sessions = {};
                for(let i=1; i<=10; i++) sessions[i.toString()] = false;
                sessions[sessionNum.toString()] = true;
                
                record = {
                    id: recordId,
                    studentId: studentId,
                    classId: student.classId,
                    monthYear: currentMonthYear,
                    sessions: sessions
                };
                attendanceRecords.push(record);
            }
            
            saveData('attendance', attendanceRecords);
        };

        const renderAttendanceView = () => {
            const container = document.getElementById('attendance-table-container');
            const filterClass = document.getElementById('attendance-filter-class').value;
            const monthYear = document.getElementById('attendance-month-selector').value;
            
            // C·∫≠p nh·∫≠t th√°ng hi·ªán t·∫°i cho b·ªô l·ªçc h·ªçc ph√≠ v√† doanh thu
            currentMonth = monthYear;
            document.getElementById('tuition-month-selector').value = monthYear;
            
            let filteredStudents = students;
            if (filterClass !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.classId === filterClass);
            }
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name, 'vi', { sensitivity: 'base' }));

            if (filteredStudents.length === 0) {
                container.innerHTML = `<p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Kh√¥ng t√¨m th·∫•y h·ªçc sinh n√†o trong l·ªõp n√†y.</p>`;
                return;
            }

            // Ti√™u ƒë·ªÅ c·ªôt bu·ªïi h·ªçc
            const sessionHeaders = Array.from({ length: 10 }, (_, i) => 
                `<th class="px-3 py-3 text-center text-xs font-semibold text-indigo-700 uppercase">B ${i + 1}</th>`
            ).join('');
            
            const rows = filteredStudents.map(s => {
                const record = getAttendanceRecord(s.id, monthYear);
                const sessions = record ? record.sessions : {};
                
                const sessionCells = Array.from({ length: 10 }, (_, i) => {
                    const sessionNum = i + 1;
                    const isPresent = sessions[sessionNum.toString()] === true; // L·∫•y gi√° tr·ªã t·ª´ key string
                    // Checkbox cho bu·ªïi h·ªçc
                    return `
                        <td class="px-3 py-3 text-center">
                            <input type="checkbox" 
                                class="form-checkbox h-5 w-5 text-indigo-600 rounded-lg border-gray-300 focus:ring-indigo-500 cursor-pointer transition duration-150 transform hover:scale-110" 
                                ${isPresent ? 'checked' : ''}
                                onclick="updateAttendance('${s.id}', ${sessionNum})"
                            >
                        </td>
                    `;
                }).join('');

                return `
                    <tr class="border-b last:border-b-0 hover:bg-indigo-50 transition duration-150">
                        <td class="p-3 text-sm font-semibold text-gray-800 sticky left-0 bg-white border-r">${s.name}</td>
                        <td class="p-3 text-sm text-center">
                            <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-blue-100 text-blue-700">${s.classId}</span>
                        </td>
                        ${sessionCells}
                    </tr>
                `;
            }).join('');

            container.innerHTML = `
                <div class="overflow-x-auto rounded-2xl shadow-lg border border-gray-100 mt-6 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50 sticky top-0">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-bold text-indigo-700 uppercase tracking-wider sticky left-0 bg-indigo-50 border-r w-40">T√™n H·ªçc Sinh</th>
                                <th class="px-3 py-3 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider w-16">L·ªõp</th>
                                ${sessionHeaders}
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100">${rows}</tbody>
                    </table>
                </div>
            `;
        };
        window.renderAttendanceView = renderAttendanceView;

        const renderTuitionTable = () => {
            const container = document.getElementById('tuition-table-container');
            const filterClass = document.getElementById('tuition-filter-class').value;
            const monthYear = document.getElementById('tuition-month-selector').value;
            
            let filteredStudents = students.slice();
            if (filterClass !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.classId === filterClass);
            }
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name, 'vi', { sensitivity: 'base' }));

            if (filteredStudents.length === 0) {
                container.innerHTML = `<p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Kh√¥ng t√¨m th·∫•y h·ªçc sinh n√†o trong l·ªõp n√†y.</p>`;
                return;
            }

            let totalRevenueMonth = 0;
            const rows = filteredStudents.map(s => {
                const record = getAttendanceRecord(s.id, monthYear);
                const sessions = record ? record.sessions : {};
                
                // ƒê·∫øm s·ªë bu·ªïi c√≥ m·∫∑t
                const attendedCount = Object.keys(sessions).reduce((count, key) => {
                    return sessions[key] === true ? count + 1 : count;
                }, 0);
                
                const tuitionRate = s.tuitionRate || CLASS_RATES[s.classId] || 0;
                const monthlyTuition = attendedCount * tuitionRate;
                totalRevenueMonth += monthlyTuition;

                // Tr·∫°ng th√°i kh√≥a h·ªçc (gi·∫£ ƒë·ªãnh kh√≥a 10 bu·ªïi)
                let statusBadge = '';
                let badgeColor = '';
                if (attendedCount === 10) {
                    badgeColor = 'bg-green-100 text-green-700';
                } else if (attendedCount > 0) {
                    badgeColor = 'bg-yellow-100 text-yellow-700';
                } else {
                    badgeColor = 'bg-gray-200 text-gray-600';
                }
                statusBadge = `<span class="inline-block px-3 py-1 text-xs font-bold rounded-full ${badgeColor}">${attendedCount}/10 Bu·ªïi</span>`;

                return `
                    <tr class="border-b last:border-b-0 hover:bg-indigo-50 transition duration-150">
                        <td class="p-4 text-sm font-semibold text-gray-800">${s.name}</td>
                        <td class="p-4 text-sm text-center">${s.classId}</td>
                        <td class="p-4 text-sm text-right font-medium text-gray-600">${formatCurrency(tuitionRate)}</td>
                        <td class="p-4 text-center">${statusBadge}</td>
                        <td class="p-4 text-lg font-extrabold text-right text-indigo-600">${formatCurrency(monthlyTuition)}</td>
                    </tr>
                `;
            }).join('');

            container.innerHTML = `
                <div class="overflow-x-auto rounded-2xl shadow-lg border border-gray-100 mt-6 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th class="px-4 py-4 text-left text-xs font-bold text-indigo-700 uppercase tracking-wider">T√™n H·ªçc Sinh</th>
                                <th class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">L·ªõp</th>
                                <th class="px-4 py-4 text-right text-xs font-bold text-indigo-700 uppercase tracking-wider">Gi√° Bu·ªïi</th>
                                <th class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">S·ªë Bu·ªïi (10)</th>
                                <th class="px-4 py-4 text-right text-xs font-bold text-indigo-700 uppercase tracking-wider">T·ªïng H·ªçc Ph√≠ Th√°ng</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100">${rows}</tbody>
                        <tfoot>
                            <tr class="bg-indigo-100 font-extrabold text-indigo-800 border-t-2 border-indigo-300">
                                <td colspan="4" class="p-4 text-right text-xl">T·ªîNG THU NH·∫¨P TH√ÅNG ${monthYear} (L·ªçc):</td>
                                <td class="p-4 text-2xl text-right">${formatCurrency(totalRevenueMonth)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
        };
        window.renderTuitionTable = renderTuitionTable;

        // --- MODULE DOANH THU T·ªîNG H·ª¢P ---
        const calculateMonthlyIncome = (monthYear) => {
            let monthlyRevenue = 0;
            const studentsMap = students.reduce((acc, s) => { acc[s.id] = s; return acc; }, {});
            // L·ªçc c√°c b·∫£n ghi ƒëi·ªÉm danh trong th√°ng ƒë∆∞·ª£c ch·ªçn
            const monthRecords = attendanceRecords.filter(r => r.monthYear === monthYear);
            
            monthRecords.forEach(record => {
                const student = studentsMap[record.studentId];
                if (student) {
                    const sessions = record.sessions || {};
                    const attendedCount = Object.keys(sessions).reduce((count, key) => {
                        return sessions[key] === true ? count + 1 : count;
                    }, 0);
                    const tuitionRate = student.tuitionRate || CLASS_RATES[student.classId] || 0;
                    monthlyRevenue += attendedCount * tuitionRate;
                }
            });
            return monthlyRevenue;
        };

        const renderIncomeDashboard = () => {
            const monthYear = document.getElementById('income-month-selector').value;
            const revenue = calculateMonthlyIncome(monthYear);
            
            // T√¨m 3 th√°ng g·∫ßn nh·∫•t ƒë·ªÉ so s√°nh
            const date = new Date(monthYear + '-01');
            const months = [];
            
            // L√πi l·∫°i 2 th√°ng
            const tempDate = new Date(date);
            tempDate.setMonth(tempDate.getMonth() - 2);
            
            // Ti·∫øn l√™n 3 th√°ng (t·ª´ th√°ng l√πi)
            for (let i = 0; i < 3; i++) {
                const current = new Date(tempDate);
                current.setMonth(current.getMonth() + i);

                const year = current.getFullYear();
                const month = current.getMonth() + 1; // 1-12
                const monthStr = month < 10 ? '0' + month : month;
                months.push(`${year}-${monthStr}`);
            }

            const comparisonData = months.map(m => ({
                month: m,
                revenue: calculateMonthlyIncome(m)
            }));
            
            const maxRevenue = Math.max(...comparisonData.map(d => d.revenue), 1); // ƒê·∫£m b·∫£o min l√† 1 ƒë·ªÉ tr√°nh chia cho 0
            
            const barChartHTML = comparisonData.map(d => {
                const heightPercent = (d.revenue / maxRevenue) * 100;
                const isCurrent = d.month === monthYear;
                // ƒê·ªãnh d·∫°ng th√°ng: MM/YYYY
                const displayMonth = d.month.split('-')[1] ? `${d.month.split('-')[1]}/${d.month.split('-')[0]}` : d.month;
                
                return `
                    <div class="flex flex-col items-center mx-3 flex-1 min-w-[50px]">
                        <div class="relative w-full max-w-12 h-40 bg-gray-200 rounded-t-lg overflow-hidden border border-gray-300">
                            <div class="absolute bottom-0 w-full rounded-b-lg transition-all duration-700 ease-out 
                                ${isCurrent ? 'bg-indigo-600 shadow-lg shadow-indigo-500/50' : 'bg-green-500 shadow-md shadow-green-400/50'}" 
                                style="height: ${heightPercent}%;">
                            </div>
                        </div>
                        <p class="mt-2 text-xs font-medium text-center ${isCurrent ? 'text-indigo-600 font-bold' : 'text-gray-600'}">${displayMonth}</p>
                        <p class="text-[10px] font-semibold text-gray-500">${formatCurrency(d.revenue).replace(/\s*‚Ç´/g, '')}</p>
                    </div>
                `;
            }).join('');
            
            document.getElementById('income-total').textContent = formatCurrency(revenue);
            document.getElementById('income-bar-chart').innerHTML = barChartHTML;
            document.getElementById('dashboard-student-count').textContent = students.length;
            
        };
        window.renderIncomeDashboard = renderIncomeDashboard;


        // --- UI UTILITIES (MODAL/MESSAGE BOX) ---
        window.closeModal = () => {
            document.getElementById('custom-modal').classList.add('hidden');
            document.getElementById('edit-modal').classList.add('hidden');
        };

        window.showModal = (title, message, callback = null, isDanger = false) => {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            
            const confirmButton = document.getElementById('modal-confirm-btn');
            const cancelButton = document.getElementById('modal-cancel-btn');
            
            // ƒê·∫∑t l·∫°i style c∆° b·∫£n cho n√∫t X√°c nh·∫≠n
            confirmButton.className = 'px-6 py-3 text-sm font-bold rounded-xl text-white transition duration-200 transform hover:scale-[1.03] focus:outline-none focus:ring-4';
            
            if (callback) {
                // X√°c nh·∫≠n/Danger mode
                confirmButton.classList.remove('hidden');
                cancelButton.classList.remove('hidden');
                
                if (isDanger) {
                    confirmButton.classList.add('bg-red-600', 'hover:bg-red-700', 'focus:ring-red-300');
                    confirmButton.textContent = 'X√°c Nh·∫≠n X√≥a';
                } else {
                    confirmButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'focus:ring-indigo-300');
                    confirmButton.textContent = 'X√°c Nh·∫≠n';
                }
                
                // G√°n l·∫°i s·ª± ki·ªán
                confirmButton.onclick = () => {
                    closeModal();
                    callback();
                };
                cancelButton.onclick = closeModal;
            } else {
                // Ch·ªâ hi·ªÉn th·ªã th√¥ng b√°o
                confirmButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'focus:ring-indigo-300');
                confirmButton.textContent = 'ƒê√≥ng';
                confirmButton.onclick = closeModal;
                confirmButton.classList.remove('hidden');
                cancelButton.classList.add('hidden');
            }

            modal.classList.remove('hidden');
        };

        // --- KH·ªûI T·∫†O ·ª®NG D·ª§NG ---
        document.addEventListener('DOMContentLoaded', () => {
            loadInitialData();
            
            // ƒêi·ªÅn options cho select class
            const classSelects = document.querySelectorAll('.class-select-options');
            const options = ['<option value="all">T·∫•t c·∫£ c√°c l·ªõp</option>']
                .concat(CLASS_OPTIONS.map(c => `<option value="${c}">${c}</option>`)).join('');
            classSelects.forEach(select => {
                select.innerHTML = options;
            });
            document.getElementById('new-student-class').innerHTML = CLASS_OPTIONS.map(c => `<option value="${c}">${c}</option>`).join('');

            // Thi·∫øt l·∫≠p th√°ng hi·ªán t·∫°i
            document.getElementById('attendance-month-selector').value = currentMonth;
            document.getElementById('tuition-month-selector').value = currentMonth;
            document.getElementById('income-month-selector').value = currentMonth;
            
            // X·ª≠ l√Ω s·ª± ki·ªán thay ƒë·ªïi th√°ng/l·ªõp cho c√°c view
            document.getElementById('attendance-month-selector').onchange = renderAttendanceView;
            document.getElementById('attendance-filter-class').onchange = renderAttendanceView;
            document.getElementById('tuition-month-selector').onchange = renderTuitionTable;
            document.getElementById('tuition-filter-class').onchange = renderTuitionTable;
            document.getElementById('income-month-selector').onchange = renderIncomeDashboard;
            
            // X·ª≠ l√Ω s·ª± ki·ªán t√¨m ki·∫øm h·ªçc sinh
            document.getElementById('student-search-name').oninput = renderStudentList;

            // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã m√†n h√¨nh ƒëƒÉng nh·∫≠p
            document.getElementById('main-app').classList.add('hidden');
            
            // G√°n active cho dashboard khi v√†o app
            document.querySelector(`button[onclick="switchView('dashboard')"]`).classList.add('active');
        });
    </script>
</head>

<body>
    <div id="custom-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white rounded-3xl card-premium p-8 w-full max-w-sm m-4 transform transition-all duration-300">
            <h3 id="modal-title" class="text-2xl font-bold mb-4 text-gray-800 border-b-4 border-indigo-100 pb-2">Ti√™u ƒë·ªÅ</h3>
            <p id="modal-message" class="text-gray-600 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel-btn" onclick="closeModal()" class="hidden px-6 py-3 text-sm font-bold rounded-xl text-gray-700 border border-gray-300 hover:bg-gray-100 transition duration-200">
                    H·ªßy
                </button>
                <button id="modal-confirm-btn" class="px-6 py-3 text-sm font-bold rounded-xl text-white bg-indigo-600 hover:bg-indigo-700 transition duration-200">
                    X√°c Nh·∫≠n
                </button>
            </div>
        </div>
    </div>

    <div id="edit-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white rounded-3xl card-premium p-8 w-full max-w-md m-4 transform transition-all duration-300">
            <h3 class="text-2xl font-bold mb-6 text-gray-800 border-b-4 border-indigo-100 pb-2">‚úèÔ∏è Ch·ªânh S·ª≠a Th√¥ng Tin H·ªçc Sinh</h3>
            <form onsubmit="event.preventDefault(); submitEditStudent();">
                <input type="hidden" id="edit-student-id">
                <div class="space-y-4">
                    <div>
                        <label for="edit-student-name" class="block text-sm font-medium text-gray-700 mb-1">T√™n H·ªçc Sinh</label>
                        <input type="text" id="edit-student-name" required
                               class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3 text-gray-700">
                    </div>
                    <div>
                        <label for="edit-student-class" class="block text-sm font-medium text-gray-700 mb-1">L·ªõp H·ªçc</label>
                        <select id="edit-student-class" required
                                class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3 text-gray-700 bg-white">
                            </select>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" onclick="closeModal()"
                            class="px-6 py-3 text-sm font-bold rounded-xl text-gray-700 border border-gray-300 hover:bg-gray-100 transition duration-200">
                        H·ªßy
                    </button>
                    <button type="submit"
                            class="px-6 py-3 text-sm font-bold rounded-xl text-white bg-indigo-600 hover:bg-indigo-700 transition duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                        L∆∞u Thay ƒê·ªïi
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-700 to-purple-800 p-4">
        <div class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl w-full max-w-sm card-premium transform hover:scale-[1.01] transition duration-500">
            <div class="text-center mb-8">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-indigo-600 mx-auto transform rotate-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h1 class="text-3xl font-extrabold text-gray-800 mt-4">Trung T√¢m C√¥ Huy·ªÅn</h1>
                <p class="text-gray-500 text-lg">H·ªá th·ªëng Qu·∫£n l√Ω Gi√°o d·ª•c</p>
            </div>
            <div class="space-y-6">
                <input type="password" id="admin-password" placeholder="M·∫≠t kh·∫©u Qu·∫£n tr·ªã Vi√™n"
                       class="form-input-style w-full p-4 border-2 border-gray-200 rounded-xl" required>
                <button onclick="handleLogin()"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-xl shadow-indigo-500/50 transition duration-300 transform hover:scale-[1.03] focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    ƒêƒÇNG NH·∫¨P
                </button>
                <p class="text-xs text-red-500 pt-2 text-center">L∆∞u √Ω: M·∫≠t kh·∫©u (admin) ch·ªâ d√πng cho b·∫£n demo.</p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <header class="bg-white shadow-lg sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                <h1 class="text-3xl font-extrabold text-indigo-600">
                    <span class="text-purple-600">MATH</span> CENTER
                </h1>
                <div class="flex items-center space-x-4 text-sm text-gray-500">
                    <span id="header-status" class="font-bold text-green-600">ƒê√£ ƒëƒÉng nh·∫≠p (Admin)</span>
                    <button onclick="handleLogout()"
                            class="flex items-center space-x-2 px-4 py-2 bg-red-50 text-red-600 hover:bg-red-100 rounded-xl transition duration-150 font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1m0-10v1" /></svg>
                        <span>ƒêƒÉng Xu·∫•t</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6 pb-12 flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-8 main-content-area">
            
            <nav id="nav-bar" class="w-full lg:w-64 flex-shrink-0 bg-white p-4 rounded-3xl shadow-xl card-premium h-fit sticky top-20">
                <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 border-b pb-2">MENU CH·ª®C NƒÇNG</p>
                <div class="space-y-2">
                    <button onclick="switchView('dashboard')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                        <span>T·ªïng Quan (Dashboard)</span>
                    </button>
                    <button onclick="switchView('students')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm-6-9a4 4 0 100-8 4 4 0 000 8z" /></svg>
                        <span>Danh S√°ch H·ªçc Sinh</span>
                    </button>
                    <button onclick="switchView('attendance')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m-5 3h4a2 2 0 002-2V7a2 2 0 00-2-2H9a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                        <span>ƒêi·ªÉm Danh</span>
                    </button>
                    <button onclick="switchView('tuition')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2v5m-3-1l3 3 3-3M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span>H·ªçc Ph√≠ Chi Ti·∫øt</span>
                    </button>
                </div>
            </nav>

            <main class="flex-1 bg-white p-6 md:p-8 rounded-3xl shadow-xl card-premium"> 
                
                <div id="dashboard" class="app-view">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">üìà B·∫£ng T·ªïng Thu Nh·∫≠p</h2>
                    
                    <div class="mb-8 flex flex-col md:flex-row items-start md:items-end space-y-4 md:space-y-0 md:space-x-4 p-5 bg-indigo-50 rounded-2xl border border-indigo-200">
                        <div class="w-full md:w-auto">
                            <label for="income-month-selector" class="font-bold text-gray-700 flex-shrink-0 block mb-1">Th√°ng B√°o C√°o:</label>
                            <input type="month" id="income-month-selector" onchange="renderIncomeDashboard()"
                                   class="form-input-style rounded-xl border border-gray-300 shadow-sm p-3 transition duration-150">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                        
                        <div class="bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-6 rounded-2xl shadow-xl shadow-indigo-500/30 transform hover:scale-[1.03] transition duration-300">
                            <p class="text-sm font-semibold opacity-90">T·ªîNG THU NH·∫¨P (TH√ÅNG)</p>
                            <p id="income-total" class="text-4xl font-extrabold mt-2 tracking-tight">0‚Ç´</p>
                            <div class="flex items-center justify-between mt-3 text-sm opacity-80">
                                <span class="font-light">M·ª•c ti√™u: 100.000.000‚Ç´</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2v5m-3-1l3 3 3-3M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-teal-500 to-cyan-600 text-white p-6 rounded-2xl shadow-xl shadow-teal-500/30 transform hover:scale-[1.03] transition duration-300">
                            <p class="text-sm font-semibold opacity-90">T·ªîNG S·ªê H·ªåC SINH</p>
                            <p id="dashboard-student-count" class="text-4xl font-extrabold mt-2 tracking-tight">0</p>
                            <div class="flex items-center justify-between mt-3 text-sm opacity-80">
                                <span class="font-light">S·ªë l∆∞·ª£ng ƒëang h·ªçc t·∫°i trung t√¢m.</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20v-2h2M17 20v-2h2" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11a4 4 0 118 0M7 19h10a2 2 0 002-2v-4a2 2 0 00-2-2H7a2 2 0 00-2 2v4a2 2 0 002 2z" /></svg>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-yellow-500 to-orange-500 text-white p-6 rounded-2xl shadow-xl shadow-yellow-500/30 transform hover:scale-[1.03] transition duration-300">
                            <p class="text-sm font-semibold opacity-90">H·ªåC PH√ç CAO NH·∫§T</p>
                            <p class="text-4xl font-extrabold mt-2 tracking-tight">200.000‚Ç´</p>
                            <div class="flex items-center justify-between mt-3 text-sm opacity-80">
                                <span class="font-light">√Åp d·ª•ng cho l·ªõp K√®m 1-1.</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.954 9.954 0 0112 3c5.402 0 9.778 4.376 9.778 9.778 0 2.686-1.102 5.253-3.054 7.126M8 12h4m-4 0v4m-3 3h10a2 2 0 002-2v-2m-10 0V7a2 2 0 012-2h4a2 2 0 012 2v3m-7 0h14" /></svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-2xl shadow-inner border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-700 mb-6 border-b pb-3">So S√°nh Doanh Thu 3 Th√°ng G·∫ßn Nh·∫•t</h3>
                        <div id="income-bar-chart" class="flex justify-center items-end h-64 border-b border-gray-300 pb-4">
                            </div>
                    </div>

                </div>

                <div id="students" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">üßë‚Äçüéì Qu·∫£n L√Ω H·ªçc Sinh</h2>
                    
                    <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-200 shadow-md mb-8">
                        <h3 class="text-xl font-bold text-indigo-800 mb-4">Th√™m H·ªçc Sinh M·ªõi</h3>
                        <form onsubmit="handleAddStudent(event)" class="flex flex-col md:flex-row gap-4">
                            <input type="text" id="new-student-name" placeholder="T√™n H·ªçc Sinh..." required
                                   class="form-input-style flex-1 rounded-xl border border-gray-300 shadow-sm p-3 text-gray-700">
                            <select id="new-student-class" required
                                    class="form-input-style w-full md:w-48 rounded-xl border border-gray-300 shadow-sm p-3 text-gray-700 bg-white">
                                </select>
                            <button type="submit"
                                    class="w-full md:w-auto px-6 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-300 hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-indigo-300">
                                Th√™m H·ªçc Sinh
                            </button>
                        </form>
                    </div>

                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-6 items-end p-5 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        <div class="w-full md:w-1/3">
                            <label for="student-filter-class" class="block text-sm font-medium text-gray-700 mb-1">L·ªçc theo L·ªõp</label>
                            <select id="student-filter-class" onchange="renderStudentList()"
                                    class="form-input-style class-select-options block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                                </select>
                        </div>
                        <div class="w-full md:flex-1">
                            <label for="student-search-name" class="block text-sm font-medium text-gray-700 mb-1">T√¨m ki·∫øm theo T√™n</label>
                            <input type="text" id="student-search-name" placeholder="Nh·∫≠p t√™n h·ªçc sinh..."
                                   class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3">
                        </div>
                    </div>

                    <div class="mt-6" id="student-list-container">
                        <p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">ƒêang t·∫£i danh s√°ch h·ªçc sinh...</p>
                    </div>
                </div>

                <div id="attendance" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">‚úÖ Qu·∫£n L√Ω ƒêi·ªÉm Danh (Kh√≥a 10 Bu·ªïi)</h2>
                    
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-end p-5 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        <div class="w-full md:w-auto">
                            <label for="attendance-month-selector" class="block text-sm font-medium text-gray-700 mb-1">Ch·ªçn Th√°ng:</label>
                            <input type="month" id="attendance-month-selector"
                                   class="form-input-style rounded-xl border border-gray-300 shadow-sm p-3 transition duration-150">
                        </div>
                        <div class="w-full md:flex-1">
                            <label for="attendance-filter-class" class="block text-sm font-medium text-gray-700 mb-1">L·ªçc theo L·ªõp:</label>
                            <select id="attendance-filter-class"
                                    class="form-input-style class-select-options block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                                </select>
                        </div>
                    </div>

                    <div class="mt-6" id="attendance-table-container">
                        <p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Vui l√≤ng ch·ªçn L·ªõp v√† Th√°ng ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒëi·ªÉm danh...</p>
                    </div>
                </div>

                <div id="tuition" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">üí∞ H·ªçc Ph√≠ Chi Ti·∫øt (T√≠nh To√°n Thu Nh·∫≠p)</h2>
                    
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-end p-5 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        <div class="w-full md:w-auto">
                            <label for="tuition-month-selector" class="block text-sm font-medium text-gray-700 mb-1">Ch·ªçn Th√°ng:</label>
                            <input type="month" id="tuition-month-selector" 
                                   class="form-input-style rounded-xl border border-gray-300 shadow-sm p-3 transition duration-150">
                        </div>
                        <div class="w-full md:flex-1">
                            <label for="tuition-filter-class" class="block text-sm font-medium text-gray-700 mb-1">L·ªçc theo L·ªõp:</label>
                            <select id="tuition-filter-class" 
                                    class="form-input-style class-select-options block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                                </select>
                        </div>
                    </div>

                    <div class="mt-6" id="tuition-table-container">
                        <p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Vui l√≤ng ch·ªçn L·ªõp v√† Th√°ng ƒë·ªÉ xem chi ti·∫øt h·ªçc ph√≠...</p>
                    </div>
                </div>

            </main>
        </div>
    </div>
    
    <footer class="mt-12 py-6 border-t-4 border-indigo-100 text-center text-sm text-gray-500 bg-white">
        &copy; 2025 Trung T√¢m To√°n C√¥ Huy·ªÅn. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u. Thi·∫øt k·∫ø hi·ªán ƒë·∫°i b·ªüi Tr·∫ßn H·ªØu Lu√¢n
    </footer>
</body>
</html>
