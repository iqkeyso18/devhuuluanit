<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Quản Lý Trung Tâm Toán Cô Huyền</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Sử dụng font Inter hiện đại */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Nền trắng xanh nhạt hiện đại */
        }
        
        .main-content-area {
            min-height: calc(100vh - 80px);
        }
        
        /* 1. Thiết kế Card Cao Cấp (Premium Card Style) */
        .card-premium {
            border-radius: 1.5rem; /* rounded-3xl */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
            border: 1px solid #f3f4f6;
        }
        .card-premium:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -8px rgba(0, 0, 0, 0.1), 0 10px 15px -7px rgba(0, 0, 0, 0.08);
        }

        /* 2. Style cho nút Navigation Active */
        .nav-btn.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 10px -1px rgba(79, 70, 229, 0.5);
            transform: scale(1.02);
        }

        /* 3. Style tập trung cho Input/Select (Focus Ring) */
        .form-input-style {
            transition: all 0.2s ease;
        }
        .form-input-style:focus {
            outline: 2px solid transparent; /* Loại bỏ outline mặc định */
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.4); /* ring indigo-500/40 */
            border-color: #6366f1;
        }
        
        /* 4. Custom scrollbar cho table */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
    </style>
    
    <script>
        // --- CÁC HẰNG SỐ CẦN THIẾT ---
        const ADMIN_PASSWORD = "admin"; // Mật khẩu admin đơn giản (CHỈ DÙNG CHO DEMO)
        
        const CLASS_RATES = {
            '4.1': 80000, '4.2': 80000, '4.3': 80000,
            '5.1': 80000, '5.2': 80000, '5.3': 80000,
            '6.1': 80000, '6.2': 80000, '6.3': 80000,
            '7.1': 80000, '7.2': 80000, '7.3': 80000,
            '8.1': 80000, '8.2': 80000, '8.3': 80000,
            '9.1': 80000, '9.2': 80000, '9.3': 80000,
            '1-1': 200000 // Lớp kèm 1-1
        };
        const CLASS_OPTIONS = Object.keys(CLASS_RATES);
        
        const STORAGE_KEYS = {
            students: 'huyenMathCenter_students',
            attendance: 'huyenMathCenter_attendance'
        };

        // --- BIẾN STATE TOÀN CỤC CỦA ỨNG DỤNG ---
        let students = [];
        let attendanceRecords = [];
        let currentView = 'dashboard';
        let loggedIn = false;
        let currentMonth = new Date().toISOString().substring(0, 7); // YYYY-MM
        
        // --- HÀM QUẢN LÝ LOCALSTORAGE (LƯU VÀ TẢI DỮ LIỆU) ---

        /** Tải dữ liệu từ localStorage */
        const loadData = (type) => {
            const json = localStorage.getItem(STORAGE_KEYS[type]);
            try {
                return json ? JSON.parse(json) : [];
            } catch (e) {
                console.error(`Lỗi khi tải dữ liệu ${type} từ localStorage:`, e);
                return [];
            }
        };

        /** Lưu dữ liệu vào localStorage và tự động render lại UI */
        const saveData = (type, data) => {
            localStorage.setItem(STORAGE_KEYS[type], JSON.stringify(data));
            // Cập nhật state cục bộ
            if (type === 'students') students = data;
            if (type === 'attendance') attendanceRecords = data;
            
            // Giả lập cập nhật real-time bằng cách render lại các view
            if (loggedIn) {
                if (currentView === 'students') renderStudentList();
                if (currentView === 'attendance') renderAttendanceView();
                if (currentView === 'tuition') renderTuitionTable();
                if (currentView === 'dashboard') renderIncomeDashboard();
            }
        };

        /** Tải dữ liệu ban đầu khi ứng dụng khởi động */
        const loadInitialData = () => {
            students = loadData('students');
            attendanceRecords = loadData('attendance');
        };

        // --- HÀM TIỆN ÍCH ---
        const formatCurrency = (amount) => {
            // Sử dụng Intl.NumberFormat để hiển thị VND đẹp mắt
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        };
        
        // --- HÀM QUẢN LÝ TÀI KHOẢN (CLIENT-SIDE FAKE ADMIN) ---
        window.handleLogin = () => {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                loggedIn = true;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('header-status').textContent = 'Đã đăng nhập (Admin)';
                loadInitialData(); // Tải dữ liệu ngay sau khi đăng nhập
                switchView(currentView); // Hiển thị dashboard
            } else {
                showModal('Lỗi Đăng Nhập', 'Mật khẩu quản trị không đúng. Vui lòng thử lại.');
            }
            document.getElementById('admin-password').value = ''; // Xóa mật khẩu
        };

        window.handleLogout = () => {
             showModal('Xác Nhận Đăng Xuất', 'Bạn có chắc chắn muốn đăng xuất khỏi hệ thống?', () => {
                loggedIn = false;
                currentView = 'dashboard';
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('header-status').textContent = 'Chưa đăng nhập';
                document.getElementById('nav-bar').querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
             });
        }

        // --- CHUYỂN ĐỔI VIEW ---
        window.switchView = (viewId) => {
            if (!loggedIn) return;
            currentView = viewId;
            document.querySelectorAll('.app-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            // Xử lý Active state trên thanh Nav
            document.querySelectorAll('#nav-bar button').forEach(el => 
                el.classList.remove('active'));
            document.querySelector(`button[onclick="switchView('${viewId}')"]`).classList.add('active');

            // Render lại nội dung cụ thể
            if (viewId === 'students') renderStudentList();
            if (viewId === 'attendance') renderAttendanceView();
            if (viewId === 'tuition') renderTuitionTable();
            if (viewId === 'dashboard') renderIncomeDashboard();
        };

        // --- MODULE QUẢN LÝ HỌC SINH ---
        window.handleAddStudent = (event) => {
            event.preventDefault();
            const nameInput = document.getElementById('new-student-name');
            const classSelect = document.getElementById('new-student-class');
            const name = nameInput.value.trim();
            const classId = classSelect.value;
            const tuitionRate = CLASS_RATES[classId];
            if (!name || !classId) {
                showModal('Lỗi', 'Vui lòng nhập tên và chọn lớp học.');
                return;
            }

            try {
                const newStudent = {
                    id: crypto.randomUUID(),
                    name,
                    classId,
                    tuitionRate,
                    createdAt: new Date().toISOString()
                };
                students.push(newStudent);
                saveData('students', students);
                
                showModal('Thành Công', `Đã thêm học sinh ${name} vào lớp ${classId}.`);
                nameInput.value = '';
                classSelect.value = CLASS_OPTIONS[0];
            } catch (e) {
                console.error("Lỗi khi thêm học sinh:", e);
                showModal('Lỗi', 'Không thể thêm học sinh. Vui lòng thử lại.');
            }
        };

        window.handleEditStudent = (id, currentName, currentClass) => {
            // Mở modal chỉnh sửa
            document.getElementById('edit-student-id').value = id;
            document.getElementById('edit-student-name').value = currentName;
            document.getElementById('edit-student-class').innerHTML = CLASS_OPTIONS.map(c => 
                `<option value="${c}" ${c === currentClass ? 'selected' : ''}>${c}</option>`
            ).join('');
            document.getElementById('edit-modal').classList.remove('hidden');
        };

        window.submitEditStudent = () => {
            const id = document.getElementById('edit-student-id').value;
            const newName = document.getElementById('edit-student-name').value.trim();
            const newClassId = document.getElementById('edit-student-class').value;
            const newRate = CLASS_RATES[newClassId];
            if (!newName || !newClassId) {
                showModal('Lỗi', 'Tên và Lớp không được để trống.');
                return;
            }

            try {
                const index = students.findIndex(s => s.id === id);
                if (index !== -1) {
                    students[index] = { ...students[index], name: newName, classId: newClassId, tuitionRate: newRate };
                    saveData('students', students);
                    document.getElementById('edit-modal').classList.add('hidden');
                    showModal('Thành Công', `Đã cập nhật thông tin học sinh ${newName}.`);
                }
            } catch (e) {
                console.error("Lỗi khi sửa học sinh:", e);
                showModal('Lỗi', 'Không thể cập nhật học sinh. Vui lòng thử lại.');
            }
        };

        window.handleDeleteStudent = (id, name) => {
            showModal('Xác Nhận Xóa', `Bạn có chắc chắn muốn xóa học sinh ${name}? Hành động này không thể hoàn tác và sẽ xóa tất cả bản ghi điểm danh liên quan.`, () => {
                try {
                    students = students.filter(s => s.id !== id);
                    saveData('students', students);
                    
                    // Xóa các bản ghi điểm danh liên quan
                    attendanceRecords = attendanceRecords.filter(r => r.studentId !== id);
                    saveData('attendance', attendanceRecords);
                    
                    showModal('Thành Công', `Đã xóa học sinh ${name}.`);
                } catch (e) {
                    console.error("Lỗi khi xóa học sinh:", e);
                    showModal('Lỗi', 'Không thể xóa học sinh. Vui lòng thử lại.');
                }
            }, true); // Cờ xác nhận nguy hiểm
        };

        const renderStudentList = () => {
            const container = document.getElementById('student-list-container');
            const filterClass = document.getElementById('student-filter-class').value;
            const searchName = document.getElementById('student-search-name').value.toLowerCase();

            let filteredStudents = students.slice(); // Copy array
            if (filterClass !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.classId === filterClass);
            }
            if (searchName) {
                filteredStudents = filteredStudents.filter(s => s.name.toLowerCase().includes(searchName));
            }
            // Sắp xếp theo tên
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name, 'vi', { sensitivity: 'base' }));

            if (filteredStudents.length === 0) {
                container.innerHTML = `<p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Không tìm thấy học sinh nào phù hợp với điều kiện lọc.</p>`;
                return;
            }
            
            const monthDisplay = `${currentMonth.substring(5, 7)}/${currentMonth.substring(0, 4)}`;

            const rows = filteredStudents.map(s => {
                // Lấy trạng thái học phí của tháng hiện tại
                const currentMonthRecord = getAttendanceRecord(s.id, currentMonth);
                const isPaid = currentMonthRecord ? currentMonthRecord.isPaid : false;

                const tuitionStatusBadge = isPaid 
                    ? `<span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700">Đã nộp (${monthDisplay})</span>`
                    : `<span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-red-100 text-red-700">Chưa nộp (${monthDisplay})</span>`;
                    
                return `
                    <tr class="border-b last:border-b-0 hover:bg-indigo-50 transition duration-150">
                        <td class="p-4 text-sm font-semibold text-gray-800">${s.name}</td>
                        <td class="p-4 text-sm text-center">
                            <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-indigo-100 text-indigo-700">${s.classId}</span>
                        </td>
                        <td class="p-4 text-sm text-right font-medium text-green-600">${formatCurrency(s.tuitionRate)}</td>
                        <td class="p-4 text-sm text-center">${tuitionStatusBadge}</td> <td class="p-4 text-sm text-center space-x-2">
                            <button onclick="handleEditStudent('${s.id}', '${s.name.replace(/'/g, "\\'")}', '${s.classId}')" 
                                title="Chỉnh sửa"
                                class="text-indigo-600 hover:text-indigo-800 transition duration-150 p-2 rounded-full hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                            </button>
                            <button onclick="handleDeleteStudent('${s.id}', '${s.name.replace(/'/g, "\\'")}')" 
                                title="Xóa"
                                class="text-red-600 hover:text-red-800 transition duration-150 p-2 rounded-full hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" 
                                viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            container.innerHTML = `
                <div class="overflow-x-auto rounded-2xl shadow-lg border border-gray-100 mt-6 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th scope="col" class="px-4 py-4 text-left text-xs font-bold text-indigo-700 uppercase tracking-wider">Tên Học Sinh</th>
                                <th scope="col" class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">Lớp</th>
                                <th scope="col" class="px-4 py-4 text-right text-xs font-bold text-indigo-700 uppercase tracking-wider">Học Phí/Buổi</th>
                                <th scope="col" class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">Trạng Thái HP</th> <th scope="col" class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">Hành Động</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100">${rows}</tbody>
                    </table>
                </div>
            `;
        };
        window.renderStudentList = renderStudentList;

        // --- MODULE ĐIỂM DANH & HỌC PHÍ ---
        
        // Lấy bản ghi điểm danh (Attendance Record) theo studentId và monthYear
        const getAttendanceRecord = (studentId, monthYear) => {
            return attendanceRecords.find(r => r.studentId === studentId && r.monthYear === monthYear);
        };

        window.updateAttendance = (studentId, sessionNum) => {
            const currentMonthYear = document.getElementById('attendance-month-selector').value;
            const recordId = `${studentId}-${currentMonthYear}`;
            let record = getAttendanceRecord(studentId, currentMonthYear);

            if (record) {
                // Cập nhật bản ghi đã tồn tại
                const currentState = record.sessions[sessionNum] || false;
                record.sessions[sessionNum] = !currentState;
                
                // Cập nhật lại array
                attendanceRecords = attendanceRecords.map(r => r.id === recordId ? record : r);
            } else {
                // Tạo mới bản ghi
                const student = students.find(s => s.id === studentId);
                if (!student) {
                    showModal('Lỗi', 'Không tìm thấy thông tin học sinh.');
                    return;
                }
                
                // Khởi tạo 10 buổi, set buổi hiện tại là true
                let sessions = {};
                for(let i=1; i<=10; i++) sessions[i.toString()] = false;
                sessions[sessionNum.toString()] = true;
                record = {
                    id: recordId,
                    studentId: studentId,
                    classId: student.classId,
                    monthYear: currentMonthYear,
                    sessions: sessions,
                    isPaid: false // <-- Mặc định là chưa nộp
                };
                attendanceRecords.push(record);
            }
            
            saveData('attendance', attendanceRecords);
        };

        /** HÀM MỚI: Cập nhật trạng thái thanh toán học phí */
        window.handleTuitionPayment = (studentId, monthYear) => {
            const recordId = `${studentId}-${monthYear}`;
            let record = getAttendanceRecord(studentId, monthYear);

            if (!record) {
                // Nếu chưa có bản ghi điểm danh (chưa đi học buổi nào), tạo bản ghi mới để lưu trạng thái paid
                const student = students.find(s => s.id === studentId);
                if (!student) {
                    showModal('Lỗi', 'Không tìm thấy thông tin học sinh.');
                    return;
                }
                record = {
                    id: recordId,
                    studentId: studentId,
                    classId: student.classId,
                    monthYear: monthYear,
                    sessions: {}, // Không có buổi nào được điểm danh
                    isPaid: true // Set thành Đã nộp
                };
                attendanceRecords.push(record);
            } else {
                // Đảo ngược trạng thái
                record.isPaid = !record.isPaid;
                attendanceRecords = attendanceRecords.map(r => r.id === recordId ? record : r);
            }
            
            saveData('attendance', attendanceRecords);
            // Cần cập nhật lại các view liên quan
            if (currentView === 'students') renderStudentList();
            if (currentView === 'tuition') renderTuitionTable();
        };


        const renderAttendanceView = () => {
            const container = document.getElementById('attendance-table-container');
            const filterClass = document.getElementById('attendance-filter-class').value;
            const monthYear = document.getElementById('attendance-month-selector').value;
            
            // Cập nhật tháng hiện tại cho bộ lọc học phí và doanh thu
            currentMonth = monthYear;
            document.getElementById('tuition-month-selector').value = monthYear;
            
            let filteredStudents = students;
            if (filterClass !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.classId === filterClass);
            }
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name, 'vi', { sensitivity: 'base' }));
            
            if (filteredStudents.length === 0) {
                container.innerHTML = `<p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Không tìm thấy học sinh nào trong lớp này.</p>`;
                return;
            }

            // Tiêu đề cột buổi học
            const sessionHeaders = Array.from({ length: 10 }, (_, i) => 
                `<th class="px-3 py-3 text-center text-xs font-semibold text-indigo-700 uppercase">B ${i + 1}</th>`
            ).join('');
            
            const rows = filteredStudents.map(s => {
                const record = getAttendanceRecord(s.id, monthYear);
                const sessions = record ? record.sessions : {};
                
                const sessionCells = Array.from({ length: 10 }, (_, i) => {
                    const sessionNum = i + 1;
                    const isPresent = sessions[sessionNum.toString()] === true; // Lấy giá trị từ key string
                    // Checkbox cho buổi học
                    return `
                        <td class="px-3 py-3 text-center">
                            <input type="checkbox" 
                                class="form-checkbox h-5 w-5 text-indigo-600 rounded-lg border-gray-300 focus:ring-indigo-500 cursor-pointer transition duration-150 transform hover:scale-110" 
                                ${isPresent ? 'checked' : ''}
                                onclick="updateAttendance('${s.id}', ${sessionNum})"
                            >
                        </td>
                    `;
                }).join('');

                return `
                    <tr class="border-b last:border-b-0 hover:bg-indigo-50 transition duration-150">
                        <td class="p-3 text-sm font-semibold text-gray-800 sticky left-0 bg-white border-r">${s.name}</td>
                        <td class="p-3 text-sm text-center">
                            <span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-blue-100 text-blue-700">${s.classId}</span>
                        </td>
                        ${sessionCells}
                    </tr>
                `;
            }).join('');

            container.innerHTML = `
                <div class="overflow-x-auto rounded-2xl shadow-lg border border-gray-100 mt-6 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50 sticky top-0">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-bold text-indigo-700 uppercase tracking-wider sticky left-0 bg-indigo-50 border-r w-40">Tên Học Sinh</th>
                                <th class="px-3 py-3 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider w-16">Lớp</th>
                                ${sessionHeaders}
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100">${rows}</tbody>
                    </table>
                </div>
            `;
        };
        window.renderAttendanceView = renderAttendanceView;

        const renderTuitionTable = () => {
            const container = document.getElementById('tuition-table-container');
            const filterClass = document.getElementById('tuition-filter-class').value;
            const monthYear = document.getElementById('tuition-month-selector').value;
            
            let filteredStudents = students.slice();
            if (filterClass !== 'all') {
                filteredStudents = filteredStudents.filter(s => s.classId === filterClass);
            }
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name, 'vi', { sensitivity: 'base' }));
            
            if (filteredStudents.length === 0) {
                container.innerHTML = `<p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Không tìm thấy học sinh nào trong lớp này.</p>`;
                return;
            }

            let totalRevenueMonth = 0;
            let totalRevenuePaid = 0; // BIẾN MỚI: Tổng thu nhập đã nộp

            const rows = filteredStudents.map(s => {
                const record = getAttendanceRecord(s.id, monthYear);
                const sessions = record ? record.sessions : {};
                const isPaid = record ? record.isPaid : false; // LẤY TRẠNG THÁI ĐÃ NỘP

                // Đếm số buổi có mặt
                const attendedCount = Object.keys(sessions).reduce((count, key) => {
                    return sessions[key] === true ? count + 1 : count;
                }, 0);
                
                const tuitionRate = s.tuitionRate || CLASS_RATES[s.classId] || 0;
                const monthlyTuition = attendedCount * tuitionRate;
                totalRevenueMonth += monthlyTuition;

                if (isPaid) {
                    totalRevenuePaid += monthlyTuition; // CỘNG VÀO TỔNG ĐÃ NỘP
                }

                // Trạng thái khóa học (giả định khóa 10 buổi)
                let statusBadge = '';
                let badgeColor = '';
                if (attendedCount === 10) {
                    badgeColor = 'bg-green-100 text-green-700';
                } else if (attendedCount > 0) {
                    badgeColor = 'bg-yellow-100 text-yellow-700';
                } else {
                    badgeColor = 'bg-gray-200 text-gray-600';
                }
                statusBadge = `<span class="inline-block px-3 py-1 text-xs font-bold rounded-full ${badgeColor}">${attendedCount}/10 Buổi</span>`;

                // TẠO BADGE TRẠNG THÁI THANH TOÁN
                const paymentStatusBadge = isPaid
                    ? `<span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-green-500 text-white shadow-md">✅ Đã Nộp</span>`
                    : `<span class="inline-block px-3 py-1 text-xs font-bold rounded-full bg-red-500 text-white shadow-md">❌ Chưa Nộp</span>`;
                
                // TẠO NÚT TOGGLE
                const toggleButton = `
                    <button onclick="handleTuitionPayment('${s.id}', '${monthYear}')"
                        title="${isPaid ? 'Bấm để hủy trạng thái Đã Nộp' : 'Bấm để đánh dấu Đã Nộp'}"
                        class="mt-1 px-3 py-1 text-xs font-bold rounded-lg transition duration-150 w-full ${isPaid ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-green-600 text-white hover:bg-green-700'}">
                        ${isPaid ? 'Hủy Đã Nộp' : 'Đánh Dấu Đã Nộp'}
                    </button>
                `;

                return `
                    <tr class="border-b last:border-b-0 hover:bg-indigo-50 transition duration-150">
                        <td class="p-4 text-sm font-semibold text-gray-800">${s.name}</td>
                        <td class="p-4 text-sm text-center">${s.classId}</td>
                        <td class="p-4 text-sm text-right font-medium text-gray-600">${formatCurrency(tuitionRate)}</td>
                        <td class="p-4 text-center">${statusBadge}</td>
                        <td class="p-4 text-lg font-extrabold text-right text-indigo-600">${formatCurrency(monthlyTuition)}</td>
                        <td class="p-4 text-center space-y-1">
                            ${paymentStatusBadge}
                            ${toggleButton}
                        </td> </tr>
                `;
            }).join('');

            container.innerHTML = `
                <div class="overflow-x-auto rounded-2xl shadow-lg border border-gray-100 mt-6 custom-scrollbar">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th class="px-4 py-4 text-left text-xs font-bold text-indigo-700 uppercase tracking-wider">Tên Học Sinh</th>
                                <th class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">Lớp</th>
                                <th class="px-4 py-4 text-right text-xs font-bold text-indigo-700 uppercase tracking-wider">Giá Buổi</th>
                                <th class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">Số Buổi (10)</th>
                                <th class="px-4 py-4 text-right text-xs font-bold text-indigo-700 uppercase tracking-wider">Tổng Học Phí Tháng</th>
                                <th class="px-4 py-4 text-center text-xs font-bold text-indigo-700 uppercase tracking-wider">Trạng Thái Thanh Toán</th> </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-100">${rows}</tbody>
                        <tfoot>
                            <tr class="bg-yellow-100 font-extrabold text-yellow-800 border-t border-b border-yellow-300">
                                <td colspan="5" class="p-3 text-right text-base">Tổng HP Cần Thu (Theo số buổi đã điểm danh):</td>
                                <td class="p-3 text-lg text-right">${formatCurrency(totalRevenueMonth)}</td>
                            </tr>
                            <tr class="bg-green-100 font-extrabold text-green-800 border-b border-green-300">
                                <td colspan="5" class="p-3 text-right text-base">Tổng HP ĐÃ NỘP trong Tháng ${monthYear} (Lọc):</td>
                                <td class="p-3 text-lg text-right">${formatCurrency(totalRevenuePaid)}</td>
                            </tr>
                            <tr class="bg-red-100 font-extrabold text-red-700 border-b-2 border-red-300">
                                <td colspan="5" class="p-3 text-right text-base">Tổng HP CÒN LẠI cần thu:</td>
                                <td class="p-3 text-lg text-right">${formatCurrency(totalRevenueMonth - totalRevenuePaid)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
        };
        window.renderTuitionTable = renderTuitionTable;

        // --- MODULE DOANH THU TỔNG HỢP (KHÔNG THAY ĐỔI) ---
        const calculateMonthlyIncome = (monthYear) => {
            let monthlyRevenue = 0;
            const studentsMap = students.reduce((acc, s) => { acc[s.id] = s; return acc; }, {});
            // Lọc các bản ghi điểm danh trong tháng được chọn
            const monthRecords = attendanceRecords.filter(r => r.monthYear === monthYear);
            monthRecords.forEach(record => {
                const student = studentsMap[record.studentId];
                if (student) {
                    const sessions = record.sessions || {};
                    const attendedCount = Object.keys(sessions).reduce((count, key) => {
                        return sessions[key] === true ? count + 1 : count;
                    }, 0);
                    const tuitionRate = student.tuitionRate || CLASS_RATES[student.classId] || 0;
                    // LƯU Ý: Dashboard vẫn tính tổng thu nhập dựa trên số buổi đã đi học (Cần Thu), không dựa trên trạng thái đã nộp
                    monthlyRevenue += attendedCount * tuitionRate;
                }
            });
            return monthlyRevenue;
        };

        const renderIncomeDashboard = () => {
            const monthYear = document.getElementById('income-month-selector').value;
            const revenue = calculateMonthlyIncome(monthYear);
            
            // Tìm 3 tháng gần nhất để so sánh
            const date = new Date(monthYear + '-01');
            const months = [];
            
            // Lùi lại 2 tháng
            const tempDate = new Date(date);
            tempDate.setMonth(tempDate.getMonth() - 2);

            // Tiến lên 3 tháng (từ tháng lùi)
            for (let i = 0; i < 3; i++) {
                const current = new Date(tempDate);
                current.setMonth(current.getMonth() + i);
                const year = current.getFullYear();
                const month = current.getMonth() + 1; // 1-12
                const monthStr = month < 10 ? '0' + month : month;
                months.push(`${year}-${monthStr}`);
            }

            const comparisonData = months.map(m => ({ month: m, revenue: calculateMonthlyIncome(m) }));
            const maxRevenue = Math.max(...comparisonData.map(d => d.revenue), 1); // Đảm bảo min là 1 để tránh chia cho 0

            const barChartHTML = comparisonData.map(d => {
                const heightPercent = (d.revenue / maxRevenue) * 100;
                const isCurrent = d.month === monthYear;
                // Định dạng tháng: MM/YYYY
                const displayMonth = d.month.split('-')[1] ? `${d.month.split('-')[1]}/${d.month.split('-')[0]}` : d.month;

                return `
                    <div class="flex flex-col items-center mx-3 flex-1 min-w-[50px]">
                        <div class="relative w-full max-w-12 h-40 bg-gray-200 rounded-t-lg overflow-hidden border border-gray-300">
                            <div class="absolute bottom-0 w-full rounded-b-lg transition-all duration-700 ease-out ${isCurrent ? 'bg-indigo-600 shadow-lg shadow-indigo-500/50' : 'bg-green-500 shadow-md shadow-green-400/50'}" 
                                style="height: ${heightPercent}%;">
                                <span class="absolute top-[-25px] left-1/2 transform -translate-x-1/2 text-xs font-bold text-gray-700 w-max">${formatCurrency(d.revenue)}</span>
                            </div>
                        </div>
                        <p class="mt-2 text-xs font-medium text-gray-600">${displayMonth}</p>
                    </div>
                `;
            }).join('');


            document.getElementById('dashboard-monthly-revenue').textContent = formatCurrency(revenue);
            document.getElementById('dashboard-student-count').textContent = students.length;
            document.getElementById('monthly-comparison-chart').innerHTML = barChartHTML;
        };
        window.renderIncomeDashboard = renderIncomeDashboard;

        // --- CÁC HÀM XỬ LÝ MODAL (POPUP) ---

        window.closeModal = () => {
            document.getElementById('custom-modal').classList.add('hidden');
        };

        window.showModal = (title, message, callback = null, isDanger = false) => {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            const confirmButton = document.getElementById('modal-confirm-btn');
            const cancelButton = document.getElementById('modal-cancel-btn');

            // Đặt lại style cơ bản cho nút Xác nhận
            confirmButton.className = 'px-6 py-3 text-sm font-bold rounded-xl text-white transition duration-200 transform hover:scale-[1.03] focus:outline-none focus:ring-4';
            
            if (callback) { // Xác nhận/Danger mode
                confirmButton.classList.remove('hidden');
                cancelButton.classList.remove('hidden');
                if (isDanger) {
                    confirmButton.classList.add('bg-red-600', 'hover:bg-red-700', 'focus:ring-red-300');
                    confirmButton.textContent = 'Xác Nhận Xóa';
                } else {
                    confirmButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'focus:ring-indigo-300');
                    confirmButton.textContent = 'Xác Nhận';
                }
                // Gán lại sự kiện
                confirmButton.onclick = () => { closeModal(); callback(); };
                cancelButton.onclick = closeModal;
            } else { // Chỉ hiển thị thông báo
                confirmButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'focus:ring-indigo-300');
                confirmButton.textContent = 'Đóng';
                confirmButton.onclick = closeModal;
                confirmButton.classList.remove('hidden');
                cancelButton.classList.add('hidden');
            }
            modal.classList.remove('hidden');
        };

        // --- KHỞI TẠO ỨNG DỤNG ---
        document.addEventListener('DOMContentLoaded', () => {
            loadInitialData();
            
            // Điền options cho select class
            const classSelects = document.querySelectorAll('.class-select-options');
            const options = ['<option value="all">Tất cả các lớp</option>']
                .concat(CLASS_OPTIONS.map(c => `<option value="${c}">${c}</option>`)).join('');
            classSelects.forEach(select => {
                select.innerHTML = options;
            });
            document.getElementById('new-student-class').innerHTML = CLASS_OPTIONS.map(c => `<option value="${c}">${c}</option>`).join('');

            // Thiết lập tháng hiện tại
            document.getElementById('attendance-month-selector').value = currentMonth;
            document.getElementById('tuition-month-selector').value = currentMonth;
            document.getElementById('income-month-selector').value = currentMonth;
            
            // Xử lý sự kiện thay đổi tháng/lớp cho các view
            document.getElementById('attendance-month-selector').onchange = renderAttendanceView;
            document.getElementById('attendance-filter-class').onchange = renderAttendanceView;
            document.getElementById('tuition-month-selector').onchange = renderTuitionTable;
            document.getElementById('tuition-filter-class').onchange = renderTuitionTable;
            document.getElementById('income-month-selector').onchange = renderIncomeDashboard;

            // Xử lý sự kiện tìm kiếm học sinh
            document.getElementById('student-search-name').oninput = renderStudentList;

            // Mặc định hiển thị màn hình đăng nhập
            document.getElementById('main-app').classList.add('hidden');
            // Gán active cho dashboard khi vào app
            document.querySelector(`button[onclick="switchView('dashboard')"]`).classList.add('active');
        });
    </script>
</head>
<body>
    <div id="custom-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl transform scale-100 transition duration-300">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Thông báo</h3>
            <p id="modal-message" class="text-gray-600 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeModal()" id="modal-cancel-btn" 
                        class="px-6 py-3 text-sm font-bold rounded-xl text-gray-700 border border-gray-300 hover:bg-gray-100 transition duration-200">
                    Hủy
                </button>
                <button type="button" id="modal-confirm-btn" class="hidden"></button>
            </div>
        </div>
    </div>
    
    <div id="edit-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-40 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Chỉnh Sửa Thông Tin Học Sinh</h3>
            <form onsubmit="event.preventDefault(); submitEditStudent();">
                <input type="hidden" id="edit-student-id">
                <div class="space-y-4">
                    <div>
                        <label for="edit-student-name" class="block text-sm font-medium text-gray-700 mb-1">Tên Học Sinh</label>
                        <input type="text" id="edit-student-name" required 
                               class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3 text-gray-700">
                    </div>
                    <div>
                        <label for="edit-student-class" class="block text-sm font-medium text-gray-700 mb-1">Lớp Học</label>
                        <select id="edit-student-class" required 
                                class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3 text-gray-700 bg-white">
                        </select>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" onclick="closeModal()" 
                            class="px-6 py-3 text-sm font-bold rounded-xl text-gray-700 border border-gray-300 hover:bg-gray-100 transition duration-200">
                        Hủy
                    </button>
                    <button type="submit" 
                            class="px-6 py-3 text-sm font-bold rounded-xl text-white bg-indigo-600 hover:bg-indigo-700 transition duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                        Lưu Thay Đổi
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-700 to-purple-800 p-4">
        <div class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl w-full max-w-sm card-premium transform hover:scale-[1.01] transition duration-500">
            <div class="text-center mb-8">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-indigo-600 mx-auto transform rotate-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h1 class="text-3xl font-extrabold text-gray-800 mt-4">Trung Tâm Cô Huyền</h1>
                <p class="text-gray-500 text-lg">Hệ thống Quản lý Giáo dục</p>
            </div>
            <div class="space-y-6">
                <input type="password" id="admin-password" placeholder="Mật khẩu Admin" class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-4 text-gray-700 text-center" onkeypress="if(event.keyCode == 13) handleLogin()">
                <button onclick="handleLogin()" class="w-full py-4 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/50 hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    Đăng Nhập Quản Trị
                </button>
            </div>
        </div>
    </div>
    
    <div id="main-app" class="min-h-screen flex">
        <aside class="w-64 bg-white p-6 border-r-4 border-indigo-50 shadow-2xl">
            <div class="text-center border-b pb-4 mb-6">
                <h3 class="text-xl font-extrabold text-indigo-700">Quản Lý Trung Tâm</h3>
                <p id="header-status" class="text-sm text-gray-500 mt-1">Chưa đăng nhập</p>
            </div>
            <nav id="nav-bar" class="space-y-2">
                <p class="text-xs font-semibold uppercase text-gray-400 pt-4 pb-2 border-t mt-4">CHỨC NĂNG</p>
                <div class="space-y-2">
                    <button onclick="switchView('dashboard')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                        <span>Tổng Quan (Dashboard)</span>
                    </button>
                    <button onclick="switchView('students')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm-6-9a4 4 0 100-8 4 4 0 000 8z" /></svg>
                        <span>Danh Sách Học Sinh</span>
                    </button>
                    <button onclick="switchView('attendance')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m-5 3h4a2 2 0 002-2V7a2 2 0 00-2-2H9a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                        <span>Điểm Danh</span>
                    </button>
                    <button onclick="switchView('tuition')" class="nav-btn w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-gray-700 hover:bg-indigo-50 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        <span>Học Phí</span>
                    </button>
                </div>
            </nav>
            <div class="mt-8 pt-4 border-t">
                <button onclick="handleLogout()" class="w-full flex items-center space-x-3 px-4 py-3 text-base font-semibold rounded-xl text-red-600 bg-red-50 hover:bg-red-100 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3v-3m3-10h4a3 3 0 013 3v1" /></svg>
                    <span>Đăng Xuất</span>
                </button>
            </div>
        </aside>

        <div class="flex-1 overflow-y-auto p-8 main-content-area">
            <main class="max-w-7xl mx-auto">
                
                <div id="dashboard" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">🏠 Tổng Quan Hệ Thống</h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        
                        <div class="bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-6 rounded-2xl shadow-xl shadow-indigo-500/30 transform hover:scale-[1.03] transition duration-300">
                            <p class="text-sm font-semibold opacity-90">DOANH THU CẦN THU THÁNG <span id="current-month-display"></span></p>
                            <p id="dashboard-monthly-revenue" class="text-4xl font-extrabold mt-2 tracking-tight">0₫</p>
                            <div class="flex items-center justify-between mt-3 text-sm opacity-80">
                                <input type="month" id="income-month-selector" class="bg-transparent border-b border-white border-opacity-50 focus:outline-none focus:border-opacity-100 p-1 rounded-sm cursor-pointer text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-teal-500 to-cyan-600 text-white p-6 rounded-2xl shadow-xl shadow-teal-500/30 transform hover:scale-[1.03] transition duration-300">
                            <p class="text-sm font-semibold opacity-90">TỔNG SỐ HỌC SINH</p>
                            <p id="dashboard-student-count" class="text-4xl font-extrabold mt-2 tracking-tight">0</p>
                            <div class="flex items-center justify-between mt-3 text-sm opacity-80">
                                <span class="font-light">Số lượng đang học tại trung tâm.</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20v-2h2M17 20v-2h2" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11a4 4 0 118 0M7 19h10a2 2 0 002-2v-4a2 2 0 00-2-2H7a2 2 0 00-2 2v4a2 2 0 002 2z" /></svg>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-yellow-500 to-orange-500 text-white p-6 rounded-2xl shadow-xl shadow-yellow-500/30 transform hover:scale-[1.03] transition duration-300">
                            <p class="text-sm font-semibold opacity-90">HỌC PHÍ CAO NHẤT</p>
                            <p class="text-4xl font-extrabold mt-2 tracking-tight">200.000₫</p>
                            <div class="flex items-center justify-between mt-3 text-sm opacity-80">
                                <span class="font-light">Áp dụng cho lớp Kèm 1-1.</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.954 9.954 0 0112 1a10 10 0 010 20c-4.418 0-8-3.582-8-8 0-1.761.57-3.376 1.528-4.707M16 17v-4h4" /></svg>
                            </div>
                        </div>
                    </div>

                    <div class="card-premium bg-white p-6 md:p-8 mt-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 border-b pb-3">So Sánh Doanh Thu 3 Tháng Gần Nhất</h3>
                        <div id="monthly-comparison-chart" class="flex justify-around items-end h-56">
                            </div>
                        <p class="text-center text-sm text-gray-500 mt-4">Doanh thu tính theo tổng học phí cần thu dựa trên số buổi đã điểm danh.</p>
                    </div>

                </div>

                <div id="students" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">🧑‍🎓 Quản Lý Học Sinh</h2>

                    <div class="card-premium bg-white p-6 md:p-8 mb-8">
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">Thêm Học Sinh Mới</h3>
                        <form onsubmit="handleAddStudent(event)" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                            <div class="md:col-span-2">
                                <label for="new-student-name" class="block text-sm font-medium text-gray-700 mb-1">Tên Học Sinh</label>
                                <input type="text" id="new-student-name" required placeholder="Nguyễn Văn A" 
                                       class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3">
                            </div>
                            <div>
                                <label for="new-student-class" class="block text-sm font-medium text-gray-700 mb-1">Lớp Học</label>
                                <select id="new-student-class" required 
                                        class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                                </select>
                            </div>
                            <div class="md:col-span-1">
                                <button type="submit" class="w-full py-3 px-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition duration-200 shadow-md shadow-indigo-300/50">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                                    Thêm
                                </button>
                            </div>
                        </form>
                    </div>

                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Danh Sách Học Sinh Hiện Có</h3>

                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-end p-5 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        <div class="w-full md:flex-1">
                            <label for="student-search-name" class="block text-sm font-medium text-gray-700 mb-1">Tìm kiếm theo Tên:</label>
                            <input type="text" id="student-search-name" placeholder="Nhập tên học sinh..." 
                                   class="form-input-style block w-full rounded-xl border border-gray-300 shadow-sm p-3">
                        </div>
                        <div class="w-full md:w-1/3">
                            <label for="student-filter-class" class="block text-sm font-medium text-gray-700 mb-1">Lọc theo Lớp:</label>
                            <select id="student-filter-class" onchange="renderStudentList()" 
                                    class="form-input-style class-select-options block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                            </select>
                        </div>
                    </div>

                    <div class="mt-6" id="student-list-container">
                        <p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Đang tải danh sách học sinh...</p>
                    </div>
                </div>

                <div id="attendance" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">✅ Quản Lý Điểm Danh (Khóa 10 Buổi)</h2>
                    
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-end p-5 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        <div class="w-full md:w-auto">
                            <label for="attendance-month-selector" class="block text-sm font-medium text-gray-700 mb-1">Chọn Tháng:</label>
                            <input type="month" id="attendance-month-selector" onchange="renderAttendanceView()" 
                                   class="form-input-style rounded-xl border border-gray-300 shadow-sm p-3 transition duration-150">
                        </div>
                        <div class="w-full md:flex-1">
                            <label for="attendance-filter-class" class="block text-sm font-medium text-gray-700 mb-1">Lọc theo Lớp:</label>
                            <select id="attendance-filter-class" onchange="renderAttendanceView()" 
                                    class="form-input-style class-select-options block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                            </select>
                        </div>
                    </div>

                    <div class="mt-6" id="attendance-table-container">
                        <p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Vui lòng chọn Lớp và Tháng để điểm danh...</p>
                    </div>
                </div>

                <div id="tuition" class="app-view hidden">
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-8 border-b-4 border-indigo-100 pb-3">💰 Quản Lý Học Phí & Doanh Thu</h2>

                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-end p-5 bg-gray-50 rounded-2xl border border-gray-200 shadow-inner">
                        <div class="w-full md:w-auto">
                            <label for="tuition-month-selector" class="block text-sm font-medium text-gray-700 mb-1">Chọn Tháng:</label>
                            <input type="month" id="tuition-month-selector" 
                                   class="form-input-style rounded-xl border border-gray-300 shadow-sm p-3 transition duration-150">
                        </div>
                        <div class="w-full md:flex-1">
                            <label for="tuition-filter-class" class="block text-sm font-medium text-gray-700 mb-1">Lọc theo Lớp:</label>
                            <select id="tuition-filter-class" 
                                    class="form-input-style class-select-options block w-full rounded-xl border border-gray-300 shadow-sm p-3 bg-white">
                                </select>
                        </div>
                    </div>

                    <div class="mt-6" id="tuition-table-container">
                        <p class="p-6 text-gray-500 text-center bg-white rounded-2xl shadow-md border border-gray-200 mt-4">Vui lòng chọn Lớp và Tháng để xem chi tiết học phí...</p>
                    </div>
                </div>

            </main>
        </div>
    </div>
    
    <footer class="mt-12 py-6 border-t-4 border-indigo-100 text-center text-sm text-gray-500 bg-white">
        &copy; 2024 Trung Tâm Toán Cô Huyền.
    </footer>
</body>
</html>
